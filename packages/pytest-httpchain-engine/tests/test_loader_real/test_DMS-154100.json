{
    "fixtures": [
        "settings"
    ],
    "vars": {
        "api_base": "https://{{ settings.host }}:{{ settings.port }}"
    },
    "stages": [
        {
            "vars": {
                "username": "{{ settings.username }}",
                "password": "{{ settings.password }}"
            },
            "$ref": "api/user/session.json#/login"
        },
        {
            "name": "Clear all playlists",
            "$ref": "api/user/playlist.json#/remove_all"
        },
        {
            "name": "Add playlist #0",
            "vars": {
                "playlist_name": "test_0",
                "playlist_desc": "Test playlist #0"
            },
            "$ref": "api/user/playlist.json#/add",
            "response": [
                {
                    "save": {
                        "vars": {
                            "test0_id": "Status.Result.List.Id"
                        }
                    }
                }
            ]
        },
        {
            "name": "Add playlist #1",
            "vars": {
                "playlist_name": "test_1",
                "playlist_desc": "Test playlist #1"
            },
            "$ref": "api/user/playlist.json#/add",
            "response": [
                {
                    "save": {
                        "vars": {
                            "test1_id": "Status.Result.List.Id"
                        }
                    }
                }
            ]
        },
        {
            "name": "Check playlists ordered forwards",
            "$ref": "api/user/playlist.json#/get_all",
            "response": [
                {
                    "verify": {
                        "status": 200
                    }
                },
                {
                    "save": {
                        "vars": {
                            "item0_id": "List.Items[0].List.Id",
                            "item0_order": "List.Items[0].List.Order",
                            "item1_id": "List.Items[1].List.Id",
                            "item1_order": "List.Items[1].List.Order"
                        }
                    }
                },
                {
                    "verify": {
                        "vars": {
                            "item0_id": "{{ test0_id }}",
                            "item0_order": 0,
                            "item1_id": "{{ test1_id }}",
                            "item1_order": 1
                        }
                    }
                }
            ]
        },
        {
            "name": "Reorder playlists backwards",
            "vars": {
                "playlists_order": "{{ test1_id }},{{ test0_id }}"
            },
            "$ref": "api/user/playlist.json#/update_all",
            "responses": [
                {
                    "verify": {
                        "status": 200,
                        "body": {
                            "not_contains": [
                                "Error",
                                "fail"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Check playlists ordered backwards",
            "$ref": "api/user/playlist.json#/get_all",
            "response": [
                {
                    "verify": {
                        "status": 200
                    }
                },
                {
                    "save": {
                        "vars": {
                            "item0_id": "List.Items[0].List.Id",
                            "item0_order": "List.Items[0].List.Order",
                            "item1_id": "List.Items[1].List.Id",
                            "item1_order": "List.Items[1].List.Order"
                        }
                    }
                },
                {
                    "verify": {
                        "vars": {
                            "item0_id": "{{ test0_id }}",
                            "item0_order": 1,
                            "item1_id": "{{ test1_id }}",
                            "item1_order": 0
                        }
                    }
                }
            ]
        },
        {
            "name": "Clear all playlists",
            "always_run": true,
            "$ref": "api/user/playlist.json#/remove_all"
        },
        {
            "$ref": "api/user/session.json#/logout"
        }
    ]
}